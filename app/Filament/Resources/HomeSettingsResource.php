<?php

namespace App\Filament\Resources;

use App\Models\Setting;
use App\Models\NewsCategory;
use App\Models\Center;
use App\Models\Teacher;
use Filament\Forms;
use Filament\Forms\Form;
use Filament\Resources\Resource;
use Filament\Forms\Components\Tabs;
use Filament\Forms\Components\TextInput;
use Filament\Forms\Components\Textarea;
use Filament\Forms\Components\Repeater;
use Filament\Forms\Components\Section;
use Filament\Forms\Components\FileUpload;
use Filament\Forms\Components\Select;
use Filament\Forms\Components\Grid;
use Filament\Notifications\Notification;

class HomeSettingsResource extends Resource
{
    protected static ?string $model = Setting::class;
    
    protected static ?string $navigationIcon = 'heroicon-o-home';
    
    protected static ?string $navigationLabel = 'C√†i ƒë·∫∑t trang ch·ªß';
    
    protected static ?string $navigationGroup = 'C√†i ƒë·∫∑t';
    
    protected static ?int $navigationSort = 3;

    public static function form(Form $form): Form
    {
        return $form
            ->schema([
                Tabs::make('HomeSettings')
                    ->tabs([
                        Tabs\Tab::make('Hero Banner')
                            ->icon('heroicon-o-photo')
                            ->schema([
                                Section::make('C·∫•u h√¨nh Hero Banner Slider')
                                    ->description('C·∫•u h√¨nh c√°c slide banner ch√≠nh c·ªßa trang ch·ªß')
                                    ->schema([
                                        Repeater::make('hero_slides')
                                            ->label('Danh s√°ch slides')
                                            ->schema([
                                                Grid::make(2)
                                                    ->schema([
                                                        FileUpload::make('image')
                                                            ->label('üñºÔ∏è ·∫¢nh slide')
                                                            ->image()
                                                            ->directory('hero-slides')
                                                            ->imageEditor()
                                                            ->imageEditorAspectRatios([
                                                                '16:9',
                                                            ])
                                                            ->required()
                                                            ->helperText('K√≠ch th∆∞·ªõc khuy·∫øn ngh·ªã: 1200x675px (16:9)'),
                                                        
                                                        TextInput::make('title')
                                                            ->label('üìù Ti√™u ƒë·ªÅ ch√≠nh')
                                                            ->required()
                                                            ->placeholder('V√≠ d·ª•: ƒê·ªìng h√†nh c√πng con v√†o tr∆∞·ªùng chuy√™n')
                                                            ->helperText('Ti√™u ƒë·ªÅ l·ªõn hi·ªÉn th·ªã tr√™n slide'),
                                                    ]),
                                                
                                                Textarea::make('description')
                                                    ->label('üìÑ M√¥ t·∫£ ng·∫Øn')
                                                    ->required()
                                                    ->rows(3)
                                                    ->placeholder('V√≠ d·ª•: Cung c·∫•p t√†i li·ªáu, kinh nghi·ªám v√† t∆∞ v·∫•n chuy√™n s√¢u...')
                                                    ->helperText('M√¥ t·∫£ chi ti·∫øt v·ªÅ n·ªôi dung slide'),
                                                
                                                Grid::make(2)
                                                    ->schema([
                                                        Section::make('N√∫t 1')
                                                            ->schema([
                                                                TextInput::make('button1_text')
                                                                    ->label('VƒÉn b·∫£n n√∫t 1')
                                                                    ->placeholder('V√≠ d·ª•: T√¨m t√†i li·ªáu')
                                                                    ->helperText('N√∫t b√™n tr√°i'),
                                                                
                                                                TextInput::make('button1_url')
                                                                    ->label('Link n√∫t 1')
                                                                    ->url()
                                                                    ->placeholder('https://example.com ho·∫∑c /trang-noi-bo'),
                                                                
                                                                Select::make('button1_color_class')
                                                                    ->label('M√†u n·ªÅn n√∫t 1')
                                                                    ->options([
                                                                        'bg-white text-primary' => 'Tr·∫Øng (Primary)',
                                                                        'bg-primary text-white' => 'Xanh Primary',
                                                                        'bg-secondary text-white' => 'Xanh Secondary',
                                                                        'bg-green-600 text-white' => 'Xanh l√°',
                                                                        'bg-blue-600 text-white' => 'Xanh d∆∞∆°ng',
                                                                        'bg-purple-600 text-white' => 'T√≠m',
                                                                        'bg-red-600 text-white' => 'ƒê·ªè',
                                                                    ])
                                                                    ->default('bg-white text-primary'),
                                                            ]),
                                                        
                                                        Section::make('N√∫t 2')
                                                            ->schema([
                                                                TextInput::make('button2_text')
                                                                    ->label('VƒÉn b·∫£n n√∫t 2')
                                                                    ->placeholder('V√≠ d·ª•: ƒêƒÉng k√Ω t∆∞ v·∫•n')
                                                                    ->helperText('N√∫t b√™n ph·∫£i'),
                                                                
                                                                TextInput::make('button2_url')
                                                                    ->label('Link n√∫t 2')
                                                                    ->url()
                                                                    ->placeholder('https://example.com ho·∫∑c /trang-noi-bo'),
                                                                
                                                                Select::make('button2_color_class')
                                                                    ->label('M√†u n·ªÅn n√∫t 2')
                                                                    ->options([
                                                                        'bg-secondary text-white' => 'Xanh Secondary',
                                                                        'bg-primary text-white' => 'Xanh Primary',
                                                                        'bg-white text-primary' => 'Tr·∫Øng (Primary)',
                                                                        'bg-green-600 text-white' => 'Xanh l√°',
                                                                        'bg-blue-600 text-white' => 'Xanh d∆∞∆°ng',
                                                                        'bg-purple-600 text-white' => 'T√≠m',
                                                                        'bg-red-600 text-white' => 'ƒê·ªè',
                                                                    ])
                                                                    ->default('bg-secondary text-white'),
                                                            ]),
                                                    ]),
                                            ])
                                            ->default([])
                                            ->addActionLabel('‚ûï Th√™m slide')
                                            ->collapsible()
                                            ->cloneable()
                                            ->itemLabel(fn (array $state): ?string => $state['title'] ?? 'Slide m·ªõi')
                                            ->reorderableWithButtons()
                                            ->helperText('T·ªëi ƒëa 5 slides ƒë·ªÉ ƒë·∫£m b·∫£o hi·ªáu su·∫•t t·ªët'),
                                    ])
                                    ->columnSpanFull(),
                            ]),

                        Tabs\Tab::make('Chuy·ªÉn c·∫•p nhanh')
                            ->icon('heroicon-o-academic-cap')
                            ->schema([
                                Section::make('C·∫•u h√¨nh ph·∫ßn Chuy·ªÉn c·∫•p nhanh')
                                    ->description('C·∫•u h√¨nh 3 box th√¥ng tin ch√≠nh (L·ªõp 1, L·ªõp 6, L·ªõp 10)')
                                    ->schema([
                                        TextInput::make('quick_transfer_title')
                                            ->label('üè∑Ô∏è Ti√™u ƒë·ªÅ ph·∫ßn')
                                            ->placeholder('V√≠ d·ª•: ƒê·ªìng h√†nh c√πng con v√†o tr∆∞·ªùng chuy√™n')
                                            ->helperText('Ti√™u ƒë·ªÅ l·ªõn hi·ªÉn th·ªã tr√™n ƒë·∫ßu ph·∫ßn'),

                                        Repeater::make('quick_transfer_boxes')
                                            ->label('Danh s√°ch box')
                                            ->schema([
                                                Grid::make(2)
                                                    ->schema([
                                                        FileUpload::make('image')
                                                            ->label('üñºÔ∏è ·∫¢nh box')
                                                            ->image()
                                                            ->directory('quick-transfer')
                                                            ->imageEditor()
                                                            ->imageEditorAspectRatios([
                                                                '1:1',
                                                                '4:3',
                                                            ])
                                                            ->required()
                                                            ->helperText('K√≠ch th∆∞·ªõc khuy·∫øn ngh·ªã: 400x300px'),

                                                        TextInput::make('title')
                                                            ->label('üìù Ti√™u ƒë·ªÅ box')
                                                            ->required()
                                                            ->placeholder('V√≠ d·ª•: Thi v√†o l·ªõp 1')
                                                            ->helperText('Ti√™u ƒë·ªÅ c·ªßa box'),
                                                    ]),

                                                Textarea::make('description')
                                                    ->label('üìÑ M√¥ t·∫£ box')
                                                    ->required()
                                                    ->rows(4)
                                                    ->placeholder('M·ªói d√≤ng l√† m·ªôt th√¥ng tin. V√≠ d·ª•:' . "\n" . '5 tr∆∞·ªùng ti·ªÉu h·ªçc h√†ng ƒë·∫ßu H√† N·ªôi' . "\n" . 'L·ªãch thi tuy·ªÉn sinh nƒÉm 2025-2026' . "\n" . 'B·ªô ƒë·ªÅ luy·ªán thi m·∫´u c·∫≠p nh·∫≠t')
                                                    ->helperText('M·ªói d√≤ng s·∫Ω hi·ªÉn th·ªã v·ªõi icon tick xanh'),

                                                TextInput::make('button_url')
                                                    ->label('üîó Link n√∫t "Xem th√™m"')
                                                    ->url()
                                                    ->placeholder('https://example.com ho·∫∑c /trang-noi-bo')
                                                    ->helperText('ƒê∆∞·ªùng d·∫´n khi click n√∫t "Xem th√™m"'),
                                            ])
                                            ->default([])
                                            ->addActionLabel('‚ûï Th√™m box')
                                            ->collapsible()
                                            ->cloneable()
                                            ->itemLabel(fn (array $state): ?string => $state['title'] ?? 'Box m·ªõi')  
                                            ->reorderableWithButtons()
                                            ->minItems(1)
                                            ->maxItems(6)
                                            ->helperText('Khuy·∫øn ngh·ªã 3 box cho hi·ªÉn th·ªã t·ªëi ∆∞u'),
                                    ])
                                    ->columnSpanFull(),
                            ]),

                        Tabs\Tab::make('Tin t·ª©c & L·ªãch thi')
                            ->icon('heroicon-o-newspaper')
                            ->schema([
                                Section::make('C·∫•u h√¨nh ph·∫ßn Tin t·ª©c & L·ªãch thi')
                                    ->description('Ch·ªçn danh m·ª•c tin t·ª©c hi·ªÉn th·ªã tr√™n trang ch·ªß')
                                    ->schema([
                                        Select::make('news_category_id')
                                            ->label('üì∞ Ch·ªçn danh m·ª•c tin tuy·ªÉn sinh')
                                            ->options(NewsCategory::where('status', 1)->pluck('name', 'id'))
                                            ->default(null)
                                            ->placeholder('Ch·ªçn danh m·ª•c tin t·ª©c...')
                                            ->helperText('Ch·ªçn danh m·ª•c tin t·ª©c s·∫Ω hi·ªÉn th·ªã c√°c b√†i vi·∫øt m·ªõi nh·∫•t t·ª´ danh m·ª•c n√†y')
                                            ->searchable()
                                            ->preload(),
                                    ])
                                    ->columnSpanFull(),
                            ]),

                        Tabs\Tab::make('Gi√°o vi√™n & Trung t√¢m')
                            ->icon('heroicon-o-user-group')
                            ->schema([
                                Section::make('C·∫•u h√¨nh Trung t√¢m luy·ªán thi')
                                    ->description('Ch·ªçn c√°c trung t√¢m hi·ªÉn th·ªã tr√™n trang ch·ªß')
                                    ->schema([
                                        Select::make('selected_centers')
                                            ->label('üè´ Trung t√¢m luy·ªán thi')
                                            ->multiple()
                                            ->options(Center::where('status', 1)->get()->mapWithKeys(function ($center) {
                                                return [$center->id => $center->name . ' - ' . ($center->tagline ?? 'Kh√¥ng c√≥ tagline')];
                                            }))
                                            ->default([])
                                            ->placeholder('T√¨m v√† ch·ªçn trung t√¢m...')
                                            ->helperText('T√¨m theo t√™n trung t√¢m. C√≥ th·ªÉ ch·ªçn nhi·ªÅu trung t√¢m')
                                            ->searchable()
                                            ->preload(),
                                    ]),

                                Section::make('C·∫•u h√¨nh Gi√°o vi√™n n·ªïi b·∫≠t')
                                    ->description('Ch·ªçn c√°c gi√°o vi√™n hi·ªÉn th·ªã tr√™n trang ch·ªß')
                                    ->schema([
                                        Select::make('selected_teachers')
                                            ->label('üë®‚Äçüè´ Gi√°o vi√™n n·ªïi b·∫≠t')
                                            ->multiple()
                                            ->options(Teacher::where('status', 1)->get()->mapWithKeys(function ($teacher) {
                                                return [$teacher->id => $teacher->name . ' - ' . ($teacher->tagline ?? 'Kh√¥ng c√≥ tagline')];
                                            }))
                                            ->default([])
                                            ->placeholder('T√¨m v√† ch·ªçn gi√°o vi√™n...')
                                            ->helperText('T√¨m theo t√™n gi√°o vi√™n. C√≥ th·ªÉ ch·ªçn nhi·ªÅu gi√°o vi√™n')
                                            ->searchable()
                                            ->preload(),
                                    ]),
                            ]),

                        Tabs\Tab::make('Th·ªëng k√™ & ƒê√°nh gi√°')
                            ->icon('heroicon-o-chart-bar')
                            ->schema([
                                Section::make('Th·ªëng k√™ website')
                                    ->description('C·∫•u h√¨nh c√°c s·ªë li·ªáu th·ªëng k√™')
                                    ->schema([
                                        Grid::make(4)
                                            ->schema([
                                                TextInput::make('stats_documents')
                                                    ->label('üìö T√†i li·ªáu')
                                                    ->placeholder('10,000+')
                                                    ->helperText('S·ªë l∆∞·ª£ng t√†i li·ªáu'),

                                                TextInput::make('stats_schools')
                                                    ->label('üè´ Tr∆∞·ªùng h·ªçc')
                                                    ->placeholder('500+')
                                                    ->helperText('S·ªë l∆∞·ª£ng tr∆∞·ªùng h·ªçc'),

                                                TextInput::make('stats_members')
                                                    ->label('üë• Th√†nh vi√™n')
                                                    ->placeholder('50,000+')
                                                    ->helperText('S·ªë l∆∞·ª£ng th√†nh vi√™n'),

                                                TextInput::make('stats_rating')
                                                    ->label('‚≠ê ƒê√°nh gi√°')
                                                    ->placeholder('4.8/5')
                                                    ->helperText('ƒêi·ªÉm ƒë√°nh gi√° trung b√¨nh'),
                                            ]),
                                    ]),

                                Section::make('ƒê√°nh gi√° t·ª´ ph·ª• huynh')
                                    ->description('C·∫•u h√¨nh ph·∫ßn "Ph·ª• huynh n√≥i g√¨ v·ªÅ ch√∫ng t√¥i"')
                                    ->schema([
                                        Repeater::make('parent_reviews')
                                            ->label('Danh s√°ch ƒë√°nh gi√°')
                                            ->schema([
                                                Grid::make(2)
                                                    ->schema([
                                                        FileUpload::make('avatar')
                                                            ->label('üñºÔ∏è ·∫¢nh ph·ª• huynh')
                                                            ->image()
                                                            ->directory('parent-reviews')
                                                            ->imageEditor()
                                                            ->imageEditorAspectRatios([
                                                                '1:1',
                                                            ])
                                                            ->required()
                                                            ->helperText('K√≠ch th∆∞·ªõc khuy·∫øn ngh·ªã: 200x200px (1:1)'),

                                                        TextInput::make('name')
                                                            ->label('üë§ T√™n ph·ª• huynh')
                                                            ->required()
                                                            ->placeholder('V√≠ d·ª•: Ch·ªã Nguy·ªÖn Th·ªã H√†')
                                                            ->helperText('T√™n hi·ªÉn th·ªã c·ªßa ph·ª• huynh'),
                                                    ]),

                                                Select::make('rating')
                                                    ->label('‚≠ê S·ªë sao ƒë√°nh gi√°')
                                                    ->options([
                                                        5 => '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5 sao)',
                                                        4.5 => '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (4.5 sao)',
                                                        4 => '‚≠ê‚≠ê‚≠ê‚≠ê (4 sao)',
                                                        3.5 => '‚≠ê‚≠ê‚≠ê‚≠ê (3.5 sao)',
                                                        3 => '‚≠ê‚≠ê‚≠ê (3 sao)',
                                                    ])
                                                    ->default(5)
                                                    ->required(),

                                                Textarea::make('review_content')
                                                    ->label('üí¨ N·ªôi dung ƒë√°nh gi√°')
                                                    ->required()
                                                    ->rows(4)
                                                    ->placeholder('V√≠ d·ª•: "T√¥i r·∫•t h√†i l√≤ng v·ªõi t√†i li·ªáu √¥n thi v√†o l·ªõp 1 c·ªßa LT365..."')
                                                    ->helperText('N·ªôi dung ƒë√°nh gi√° chi ti·∫øt c·ªßa ph·ª• huynh'),
                                            ])
                                            ->default([])
                                            ->addActionLabel('‚ûï Th√™m ƒë√°nh gi√°')
                                            ->collapsible()
                                            ->cloneable()
                                            ->itemLabel(fn (array $state): ?string => $state['name'] ?? 'ƒê√°nh gi√° m·ªõi')
                                            ->reorderableWithButtons()
                                            ->helperText('Khuy·∫øn ngh·ªã 3-5 ƒë√°nh gi√° ƒë·ªÉ hi·ªÉn th·ªã t·ªët nh·∫•t'),
                                    ]),
                            ]),
                    ])
                    ->columnSpanFull(),
            ]);
    }

    public static function getPages(): array
    {
        return [
            'index' => \App\Filament\Resources\HomeSettingsResource\Pages\ManageHomeSettings::route('/'),
        ];
    }
}
